<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/host_common :: head('prdInput')">
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body class="hostBody">
<!-- host page header(host_common.html) -->
<header th:replace="fragments/host_common :: header"></header>

<!-- host page navi -->
<nav th:replace="fragments/host_common :: navi"></nav>

<!-- 본문 내용(Body Block) -->
<div class="d-flex">
    <!-- Sidebar Block -->
    <div style="width:300px;">
        <aside th:replace="fragments/host_common :: sidebar('product')"></aside>
    </div>
    <div class="flex-fill">
        <form method="post" name="productForm" enctype="multipart/form-data">
        <div class="position-relative text-center w-95 mx-auto my-15 vertical-middle-all">
            <p class="fs-15 p-0 m-0"><b>판매상품관리</b></p>
            <p class="position-absolute m-0 top-0 end-0">
                <input type="submit" value="등록" class="blueBaseBtn px-10 py-10"
                       onclick = "javascript: productForm.action = 'h_productPro'">
            </p>
        </div>

        <div class="bg-white w-95 mx-auto mb-20 pb-15">
            <!-- 상품 기본 정보 Title Block -->
            <div class="w-97 mx-auto bg-white px-10 py-15">
                <b>·상품기본정보</b>
            </div>

            <!-- 상품 기본 정보 Input Block -->
            <table class="w-97 mx-auto bg-white border-top-1-ccc border-bottom-1-ccc td-py15 td-px10 fs-8 td-border-bottom-1-ccc tdChild1-fw-bold tdChild1-bg-lightGray vertical-middle-all">
                <col style = "width:20%">
                <col>
                <!-- mainImage 추가 -->
                <tr>
                    <td class="border-right-1-ccc">메인 이미지1</td>
                    <td>
                        <input type = "file" name = "mainFile">
                    </td>
                </tr>
                <!-- mainCategory 추가/삭제 -->
                <tr>
                    <td><label for="mainCategoryInput">1차 카테고리 추가</label></td>
                    <td>
                        <input type = "text" id = "mainCategoryInput">
                        <input type = "button" class = "whiteButton " value = "추가" th:onclick="mainCategoryAdd()">
                        <select class = "mainCategoriesSelector" id="mainCategoryDelSelector">
                            <option value = "">1차 카테고리</option>
                            <!-- 가져올 카테고리가 있으면 -->
                            <!--<th:block th:if="${bigsrhCnt > 0}">
                                <option th:each="list:${bigList}" value = "${list.bigcode}">${list.bigname}</option>
                            </th:block>-->
                        </select>
                        <input type = "button" class = "whiteButton" value = "삭제" th:onclick = "mainCategoryDel()">
                    </td>
                </tr>
                <!-- subCategory 추가/삭제 -->
                <tr>
                    <td>2차 카테고리 추가</td>
                    <td>
                        <select class="mainCategoriesSelector" id="subCategoryMainCode" th:onchange = "subCategoriesGet(this.value)">
                            <option value = "">1차 카테고리</option>
                            <!-- 가져올 카테고리가 있으면 -->
                            <!--<th:block th:if="${bigsrhCnt > 0}">
                                <option th:each="list:${bigList}" value = "${list.bigcode}">${list.bigname}</option>
                            </th:block>-->
                        </select>
                        <input type = "text" id="subCategoryInput">
                        <input type = "button" class = "whiteButton" value = "추가" th:onclick = "subCategoryAdd()">
                        <select class="subCategoriesSelector" id="subCategoryDelSelector">
                            <option value = "">2차 카테고리</option>
                            <!-- 가져올 sub 카테고리가 있으면 -->
                            <!--<th:block th:if="${mediumsrhCnt > 0}">
                                <option th:each="list:${mediumList}" value = "${list.mediumcode}">${list.mediumname}</option>
                            </th:block>-->
                        </select>
                        <input type = "button" class = "whiteButton" value = "삭제" th:onclick = "subCategoryDel()">
                    </td>
                </tr>

                <!-- 등록할 상품의 main/subCategory 선택 -->
                <tr>
                    <td>상품 카테고리*</td>
                    <td>
                        <select th:onchange = "subCategoriesGet(this.value)" class="mainCategoriesSelector">
                            <option value = "">1차 카테고리</option>
                            <!-- 가져올 카테고리가 있으면 -->
                            <!--<th:block th:if="${bigsrhCnt > 0}">
                                <option th:each="list:${bigList}" value = "${list.bigcode}">${list.bigname}</option>
                            </th:block>-->
                        </select>
                        <select class="subCategoriesSelector">
                            <option value = "">2차 카테고리</option>
                            <!-- 가져올 sub 카테고리가 있으면 -->
                            <!--<th:block th:if="${mediumsrhCnt > 0}">
                                <option th:each="list:${mediumList}" value = "${list.mediumcode}">${list.mediumname}</option>
                            </th:block>-->
                        </select>
                    </td>
                </tr>
                <!-- 등록할 상품의 name 작성 -->
                <tr>
                    <td><label for="prdName">상품명 *</label></td>
                    <td>
                        <input type = "text" id="prdName" name = "prdName">
                    </td>
                </tr>
                <!-- 등록할 상품의 tax/notTax 선택 -->
                <tr>
                    <td>과세/비과세</td>
                    <td>
                        <input type = "radio" name = "tex" id = "tax" value = "과세" checked>
                        <label for = "tax">과세</label>&emsp;
                        <input type = "radio" name = "tex" id = "notTax" value = "비과세">
                        <label for = "notTax">비과세</label>
                    </td>
                </tr>

                <!-- 등록할 상품의 tax/notTax 선택 -->
                <tr>
                    <td>브랜드</td>
                    <td>
                        <select name = "brand">
                            <option value = "">브랜드 선택</option>
                            <!-- 가져올 브랜드가 있으면 -->
                            <!--<th:block th:if="${brandsrhCnt > 0}">
                                <option th:each="list:${brandList}" value = "${list.num}">${list.name}</option>
                            </th:block>-->
                        </select>
                    </td>
                </tr>

                <!-- 등록할 상품의 icon 선택 -->
                <tr>
                    <td>아이콘</td>
                    <td>
                        <input type = "radio" name = "icon" id = "hot" value = "hot">
                        <label for = "hot">hot</label>&emsp;
                        <input type = "radio" name = "icon" id = "minPrice" value = "minPrice">
                        <label for = "minPrice">최저가</label>&emsp;
                        <input type = "radio" name = "icon" id = "best" value = "best">
                        <label for = "best">best</label>
                    </td>
                </tr>

                <!-- 등록할 상품의 적립금 선택 -->
                <tr>
                    <td>적립금</td>
                    <td>
                        <input type = "radio" name = "plus" id = "notPlus" value = "notPlus">
                        <label for = "notPlus">없음</label>&emsp;
                        <input type = "radio" name = "plus" id = "plus" value = "plus">
                        <label for = "plus">적립금</label>&emsp;
                        <input type = "text" name = "plusPay">원
                    </td>
                </tr>
            </table>

            <!-- 상품 판매 정보 Title Block -->
            <div class="w-97 mx-auto bg-white px-10 py-15">
                <b>·상품 판매정보</b>
            </div>

            <!-- 상품 판매 정보 Input Block -->
            <table class="w-97 mx-auto bg-white border-top-1-ccc border-bottom-1-ccc td-py15 td-px10 td-border-bottom-1-ccc fs-8 vertical-middle-all">
                <col style = "width:15%">
                <col>
                <col style = "width:15%">
                <col>
                <tr>
                    <td class="fw-bold bg-EAECEE">
                        <label for="salePrice">판매가격 *</label></td>
                    <td>
                        <input type = "text" id="salePrice" name = "salePrice">원
                    </td>
                    <td class="fw-bold bg-EAECEE">
                        <label for="buyPrice">매입가격 *</label></td>
                    <td>
                        <input type = "text" id="buyPrice" name = "buyPrice">원
                    </td>
                </tr>
            </table>

            <!-- 배송 관련 정보 Title Block -->
            <div class="w-97 mx-auto bg-white px-10 py-15">
                <b>·배송관련</b>
            </div>

            <!-- 배송 관련 정보 Input Block -->
            <table class="w-97 mx-auto bg-white border-top-1-ccc border-bottom-1-ccc td-px10 td-py15 td-border-bottom-1-ccc fs-8 tdChild1-bg-lightGray tdChild1-fw-bold vertical-middle-all">
                <col style = "width:20%;">
                <col>

                <!-- 예상배송소요일 설정 -->
                <tr>
                    <td><label for="deliDate">예상배송소요일 *</label></td>
                    <td><input type = "text" id = "deliDate" name = "deliDate">일
                    </td>
                </tr>

                <!-- 배송비 설정 -->
                <tr>
                    <td>배송비 설정</td>
                    <td>
                        <input type = "radio" name = "deliPay" id = "basePay" value = "basepay">
                        <label for = "basePay">기본 배송비</label><br>
                        <input type = "radio" name = "deliPay" id = "free" value = "free">
                        <label for = "free">무료</label><br>
                        <input type = "radio" name = "deliPay" id = "plusDeliPay" value = "pluspay">
                        <label for = "plusDeliPay">유료</label>
                        <input type = "text" id = "plusPay" name = "deliPrice">원
                    </td>
                </tr>
            </table>

            <!-- 상품 상세 설명 Title Block -->
            <div class="w-97 mx-auto bg-white px-10 py-15">
                <b>·상품 상세 설명</b>
            </div>

            <!-- 상품 상세 설명 Title Block -->
            <table class="w-97 mx-auto bg-white border-bottom-1-ccc border-top-1-ccc td-py15 td-px10 td-border-bottom-1-ccc fs-8 tdChild1-bg-lightGray tdChild1-fw-bold tdChild1-border-right-1-ccc vertical-middle-all">
                <col style = "width: 15%;">
                <col>
                <!-- 상품 설명 Box -->
                <tr>
                    <td colspan = "2">
                        <textarea rows="20" cols="95" name="content" class="w-100 resize-vertical border-0" ></textarea>
                    </td>
                </tr>

                <!-- 상품 이미지 file 추가 -->
                <tr>
                    <td>첨부파일1</td>
                    <td><input type = "file" name = "file1"></td>
                </tr>
                <tr>
                    <td>첨부파일2</td>
                    <td><input type = "file" name = "file2"></td>
                </tr>
                <tr>
                    <td>첨부파일3</td>
                    <td><input type = "file" name = "file3"></td>
                </tr>
                <tr>
                    <td>첨부파일4</td>
                    <td><input type = "file" name = "file4"></td>
                </tr>
                <tr>
                    <td>첨부파일5</td>
                    <td><input type = "file" name = "file5"></td>
                </tr>

                <!-- With Item 선택하기 -->
                <tr>
                    <td class="text-center py-10">
                        <input type = "hidden" name = "withItem" value = "">
                        <div id = "image" class="bg-secondary-subtle wh-100px mx-auto">
                            No image
                        </div>
                    </td>
                    <td>
                        <input type = "button" id = "detailPrd" name = "detailPrd" value = "상품정보선택"
                               class="fs-9 p-5px whiteBaseButton" onclick = "withproductChk();" >
                    </td>
                </tr>
            </table>
        </div>
        </form>
    </div>
</div>

<script>
    // MainCategory 추가하기
    function mainCategoryAdd(){
        const mainCategoryInput = document.getElementById("mainCategoryInput").value;
        const mainCategoryParam = { mainName : mainCategoryInput };

        $.ajax({
            type: 'post',
            contentType:'application/json',
            data: JSON.stringify(mainCategoryParam),
            url: '/api/mainCategory',
            success: (result) => {
                //AJAX 성공시 실행 코드
                alert(result.mainName + " 카테고리가 추가되었습니다.");
                mainCategoriesGet();
            }, error:function(e) {
                alert("error: " + e);
            }
        });
    }

    // MainCategory 삭제하기
    function mainCategoryDel(){
        const deleteMainCategoryForm = document.getElementById("mainCategoryDelSelector");
        const mainCode = deleteMainCategoryForm.value;
        const mainName = deleteMainCategoryForm.options[deleteMainCategoryForm.selectedIndex].text;

        $.ajax({
            type: 'DELETE',
            url: '/api/mainCategories/' + mainCode,
            success: (result) => {
                //AJAX 성공시 실행 코드
                alert(mainName + " 카테고리가 삭제되었습니다.");
                mainCategoriesGet();
            }, error:function(e) {
                alert("error: " + e);
            }
        });
    }

    // MainCategory 목록 화면의 mainCategoriesSeletor에 추가해주기
    function mainCategoriesGet(){
        $.ajax({
            type: 'get',
            url: '/api/mainCategories',
            success: (result) => {
                //AJAX 성공시 실행 코드(* mainCategoriesSelector Class)
                const allMainCategoryByClass = document.getElementsByClassName("mainCategoriesSelector");

                // 1. mainCategoriesSelector Clear
                for (let i = 0; i < allMainCategoryByClass.length; i++) {
                    allMainCategoryByClass[i].innerHTML = `<option value = "">1차 카테고리</option>`;
                }
                // 2. mainCategoriesSelector Option 추가
                result.forEach(data => {
                    for (let i = 0; i < allMainCategoryByClass.length; i++) {
                        const option = document.createElement('option');
                        option.innerHTML = data.mainName;
                        option.value = data.mainCode;
                        allMainCategoryByClass[i].append(option);
                    }
                })
            }, error:function(e) {
                alert("error: " + e);
            }
        });
    }

    // SubCategory 추가하기
    function subCategoryAdd(){
        const subCategoryMainCode = document.getElementById("subCategoryMainCode").value;
        const subCategoryInput = document.getElementById("subCategoryInput").value;
        const subCategoryParam = { subName : subCategoryInput };

        $.ajax({
            type: 'PUT',
            contentType:'application/json',
            data: JSON.stringify(subCategoryParam),
            url: '/api/subCategory/' + subCategoryMainCode,
            success: (result) => {
                //AJAX 성공시 실행 코드
                alert(result.subName + " 카테고리가 추가되었습니다.");
                subCategoriesGet(subCategoryMainCode);
            }, error:function(e) {
                alert("error: " + e);
            }
        });
    }

    // SubCategory 삭제하기
    function subCategoryDel(){
        const subCategoryMainCodeForm = document.getElementById("subCategoryMainCode");
        const mainCode = subCategoryMainCodeForm.value;
        const mainName = subCategoryMainCodeForm.options[subCategoryMainCodeForm.selectedIndex].text;
        const deleteSubCategoryForm = document.getElementById("subCategoryDelSelector");
        const subCode = deleteSubCategoryForm.value;
        const subName = deleteSubCategoryForm.options[deleteSubCategoryForm.selectedIndex].text;

        $.ajax({
            type: 'DELETE',
            url: '/api/subCategories/' + subCode,
            success: (result) => {
                //AJAX 성공시 실행 코드
                alert(mainName + "의 " + subName + " 카테고리가 삭제되었습니다.");
                subCategoriesGet(mainCode);
            }, error:function(e) {
                alert("error: " + e);
            }
        });
    }

    // SubCategory 목록 화면의 subCategoriesSeletor에 추가해주기
    function subCategoriesGet(mainCode){
        $.ajax({
            type: 'GET',
            url: '/api/subCategories/' + mainCode,
            success: (result) => {
                //AJAX 성공시 실행 코드(* mainCategoriesSelector Class)
                const allSubCategoryByClass = document.getElementsByClassName("subCategoriesSelector");

                // 1. mainCategoriesSelector Clear
                for (let i = 0; i < allSubCategoryByClass.length; i++) {
                    allSubCategoryByClass[i].innerHTML = `<option value = "">2차 카테고리</option>`;
                }
                // 2. mainCategoriesSelector Option 추가
                result.forEach(data => {
                    for (let i = 0; i < allSubCategoryByClass.length; i++) {
                        const option = document.createElement('option');
                        option.innerHTML = data.subName;
                        option.value = data.subCode;
                        allSubCategoryByClass[i].append(option);
                    }
                })
            }, error:function(e) {
                alert("error: " + e);
            }
        });
    }

</script>


<!-- using Javascript, Bootstrap, JQuery -->
<footer th:replace="fragments/host_common :: footer"></footer>
</body>
</html>